# 如何在链中路由执行

:::info 前提条件

本指南假设您熟悉以下概念：

- [LangChain 表达式语言 (LCEL)](/docs/concepts/lcel)
- [链接可运行对象](/docs/how_to/sequence/)
- [在运行时配置链参数](/docs/how_to/binding)
- [提示模板](/docs/concepts/prompt_templates)
- [聊天消息](/docs/concepts/messages)

:::

本指南介绍如何在 LangChain 表达式语言中进行路由。

路由允许你创建非确定性链，其中前一步的输出定义下一步。路由有助于在与 LLM 交互时提供结构和一致性。

有两种方法可以执行路由：

1. 从 [`RunnableLambda`](/docs/how_to/functions) 条件返回可运行对象（推荐）
2. 使用 `RunnableBranch`（旧版）

我们将通过一个两步序列来演示这两种方法，其中第一步将输入问题分类为关于 LangChain、Anthropic 或其他类别，然后路由到相应的提示链。

## 使用自定义函数

你可以使用自定义函数在不同输出之间进行路由。以下是一个示例：

```bash npm2yarn
npm install @langchain/anthropic @langchain/core
```

import FactoryFunctionExample from "@examples/guides/expression_language/how_to_routing_custom_function.ts";

<CodeBlock language="typescript">{FactoryFunctionExample}</CodeBlock>

## 通过语义相似性进行路由

一种特别有用的技术是使用嵌入将查询路由到最相关的提示。以下是一个示例：

import SemanticSimilarityExample from "@examples/guides/expression_language/how_to_routing_semantic_similarity.ts";

<CodeBlock language="typescript">{SemanticSimilarityExample}</CodeBlock>

## 使用 RunnableBranch

`RunnableBranch` 通过一个（条件，可运行对象）对的列表和一个默认的可运行对象来初始化。它通过将每个条件传递给调用时提供的输入来选择分支。它会选择第一个评估为 True 的条件，并使用输入运行与该条件对应的可运行对象。

如果没有匹配的条件，它将运行默认的可运行对象。

以下是一个实际示例：

import BranchExample from "@examples/guides/expression_language/how_to_routing_runnable_branch.ts";

<CodeBlock language="typescript">{BranchExample}</CodeBlock>

## 下一步

现在你已经了解了如何在组合的 LCEL 链中添加路由功能。

接下来，请查看本部分的其他 [可运行对象指南](/docs/how_to/#langchain-expression-language)。