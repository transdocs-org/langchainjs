---
hide_table_of_contents: true
---

import CodeBlock from "@theme/CodeBlock";

# 基于 Redis 的聊天记忆

为了在多个聊天会话中实现更长期的持久化存储，您可以将 `BufferMemory` 等聊天记忆类默认使用的内存中 `chatHistory` 替换为 [Redis](https://redis.io/) 实例。

## 环境准备

您需要在项目中安装 [node-redis](https://github.com/redis/node-redis)：

import IntegrationInstallTooltip from "@mdx_components/integration_install_tooltip.mdx";

<IntegrationInstallTooltip></IntegrationInstallTooltip>

```bash npm2yarn
npm install @langchain/openai @langchain/community @langchain/core redis
```

同时，您还需要一个可以连接的 Redis 实例。关于如何在本地运行 Redis 服务器，请参阅 [Redis 官方网站](https://redis.io/docs/getting-started/) 上的说明。

## 使用方法

存储在 Redis 中的每个聊天历史会话都必须具有唯一的 ID。您还可以提供可选的 `sessionTTL` 参数，用于设置会话在指定秒数后自动过期。
`config` 参数将直接传递给 [node-redis](https://github.com/redis/node-redis) 的 `createClient` 方法，支持其所有相同的参数。

import Example from "@examples/memory/redis.ts";

<CodeBlock language="typescript">{Example}</CodeBlock>

## 高级用法

您也可以直接传入一个先前创建的 [node-redis](https://github.com/redis/node-redis) 客户端实例：

import AdvancedExample from "@examples/memory/redis-advanced.ts";

<CodeBlock language="typescript">{AdvancedExample}</CodeBlock>

### Redis Sentinel 支持

您可以使用 [ioredis](https://github.com/redis/ioredis) 启用基于 Redis Sentinel 的缓存。

这需要在项目中安装 [ioredis](https://github.com/redis/ioredis)。

```bash npm2yarn
npm install ioredis
```

import RedisSentinel from "@examples/memory/redis-sentinel.ts";

<CodeBlock language="typescript">{RedisSentinel}</CodeBlock>