---
sidebar_label: Azion EdgeSQL
title: AzionRetriever
---

export const quartoRawHtml = [
  `
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">检索器</th>
<th style="text-align: center;">Self-host</th>
<th style="text-align: center;">云服务</th>
<th style="text-align: center;">包</th>
<th style="text-align: center;">[Python支持]</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><a href="https://api.js.langchain.com/classes/_langchain_community.retrievers_azion_edgesql.AzionRetriever.html">AzionRetriever</a></td>
<td style="text-align: center;">❌</td>
<td style="text-align: center;">❌</td>
<td style="text-align: center;"><span class="citation" data-cites="@langchain/community">@langchain/community</span></td>
<td style="text-align: center;">❌</td>
</tr>
</tbody>
</table>
`,
];

## 概览

这将帮助你快速上手使用 [AzionRetriever](../../../docs/concepts/#retrievers)。如需了解 AzionRetriever 所有功能和配置的详细文档，请前往 [API 参考](https://api.js.langchain.com/classes/_langchain_community.retrievers_azion_edgesql.AzionRetriever.html)。

### 集成详情

<div dangerouslySetInnerHTML={{ __html: quartoRawHtml[0] }} />

## 配置

要使用 AzionRetriever，你需要设置 AZION_TOKEN 环境变量。

```typescript
process.env.AZION_TOKEN = "your-api-key";
```

如果你在此指南中使用 OpenAI 嵌入模型，你还需要设置你的 OpenAI 密钥：

```typescript
process.env.OPENAI_API_KEY = "YOUR_API_KEY";
```

如果你想从单个查询中获取自动追踪信息，你还可以取消注释以下代码并设置你的 [LangSmith](https://docs.smith.langchain.com/) API 密钥：

```typescript
// process.env.LANGSMITH_API_KEY = "<YOUR API KEY HERE>";
// process.env.LANGSMITH_TRACING = "true";
```

### 安装

该检索器位于 `@langchain/community/retrievers/azion_edgesql` 包中：

```mdx-code-block
import IntegrationInstallTooltip from "@mdx_components/integration_install_tooltip.mdx";
import Npm2Yarn from "@theme/Npm2Yarn";

<IntegrationInstallTooltip></IntegrationInstallTooltip>

<Npm2Yarn>
  azion @langchain/openai @langchain/community
</Npm2Yarn>
```

## 实例化

现在我们可以实例化我们的检索器：

```typescript
import { AzionRetriever } from "@langchain/community/retrievers/azion_edgesql";
import { OpenAIEmbeddings } from "@langchain/openai";
import { ChatOpenAI } from "@langchain/openai";

const embeddingModel = new OpenAIEmbeddings({
  model: "text-embedding-3-small",
});

const chatModel = new ChatOpenAI({
  model: "gpt-4o-mini",
  apiKey: process.env.OPENAI_API_KEY,
});

const retriever = new AzionRetriever(embeddingModel, {
  dbName: "langchain",
  vectorTable: "documents", // 存储向量嵌入的表
  ftsTable: "documents_fts", // 存储全文搜索索引的表
  searchType: "hybrid", // 检索器使用的搜索类型
  ftsK: 2, // 从全文搜索索引返回的结果数
  similarityK: 2, // 从向量索引返回的结果数
  metadataItems: ["language", "topic"],
  filters: [{ operator: "=", column: "language", value: "en" }],
  entityExtractor: chatModel,
}); // 从向量索引返回的结果数
```

## 使用

```typescript
const query = "Australia";

await retriever.invoke(query);
```

```text
[
  Document {
    pageContent: '澳大利亚的原住民在该大陆已居住超过65,000年',
    metadata: { language: 'en', topic: 'history', searchtype: 'similarity' },
    id: '3'
  },
  Document {
    pageContent: '澳大利亚是太阳能利用和可再生能源技术领域的领导者',
    metadata: { language: 'en', topic: 'technology', searchtype: 'similarity' },
    id: '5'
  },
  Document {
    pageContent: '澳大利亚的科技行业正在迅速增长，主要城市拥有创新中心',
    metadata: { language: 'en', topic: 'technology', searchtype: 'fts' },
    id: '7'
  }
]
```

## 在链中使用

像其他检索器一样，AzionRetriever 可以通过 [链](../../../docs/how_to/sequence/) 整合到 LLM 应用程序中。

我们需要一个 LLM 或聊天模型：

```mdx-code-block
import ChatModelTabs from "@theme/ChatModelTabs";

<ChatModelTabs customVarName="llm" />
```

```typescript
import { ChatPromptTemplate } from "@langchain/core/prompts";
import {
  RunnablePassthrough,
  RunnableSequence,
} from "@langchain/core/runnables";
import { StringOutputParser } from "@langchain/core/output_parsers";

import type { Document } from "@langchain/core/documents";

const prompt = ChatPromptTemplate.fromTemplate(`
仅根据提供的上下文回答问题。

上下文: {context}

问题: {question}`);

const formatDocs = (docs: Document[]) => {
  return docs.map((doc) => doc.pageContent).join("\n\n");
};

// 参见 https://js.langchain.com/docs/tutorials/rag
const ragChain = RunnableSequence.from([
  {
    context: retriever.pipe(formatDocs),
    question: new RunnablePassthrough(),
  },
  prompt,
  llm,
  new StringOutputParser(),
]);
```

```typescript
await ragChain.invoke("Paris");
```

```text
上下文提到2024年奥运会将在巴黎举行。
```

## API 参考

如需了解 AzionRetriever 所有功能和配置的详细文档，请前往 [API 参考](https://api.js.langchain.com/classes/_langchain_community.retrievers_azion_edgesql.AzionRetriever.html)。