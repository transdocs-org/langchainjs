---
sidebar_label: Azion EdgeSQL
title: AzionVectorStore
---

export const quartoRawHtml = [
  `
<table>
<colgroup>
<col style="width: 22%" />
<col style="width: 22%" />
<col style="width: 27%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">类</th>
<th style="text-align: left;">包</th>
<th style="text-align: center;">[PY 支持]</th>
<th style="text-align: center;">包最新版本</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><a href="https://api.js.langchain.com/classes/langchain_community_vectorstores_azion_edgesql.AzionVectorStore.html"><code>AzionVectorStore</code></a></td>
<td style="text-align: left;"><a href="https://npmjs.com/@langchain/community"><code>@langchain/community</code></a></td>
<td style="text-align: center;">❌</td>
<td style="text-align: center;"><img src="https://img.shields.io/npm/v/@langchain/community?style=flat-square&amp;label=%20&amp;.png" alt="NPM - 版本" /></td>
</tr>
</tbody>
</table>
`,
];

`AzionVectorStore` 用于在 Azion 的边缘平台上通过 Edge SQL 直接使用向量嵌入来管理和搜索文档集合。

本指南提供了关于使用 Azion EdgeSQL [向量存储](../../../docs/concepts/#vectorstores) 的快速概述。有关 `AzionVectorStore` 所有功能和配置的详细文档，请参阅 [API 参考](https://api.js.langchain.com/classes/_langchain_community.vectorstores_azion_edgesql.AzionVectorStore.html)。

## 概述

### 集成细节

<div dangerouslySetInnerHTML={{ __html: quartoRawHtml[0] }} />

## 安装

要使用 `AzionVectorStore` 向量存储，你需要安装 `@langchain/community` 包。此外，你还需要一个 [Azion 账户](https://www.azion.com/en/documentation/products/accounts/creating-account/) 和一个用于访问 Azion API 的 [Token](https://www.azion.com/en/documentation/products/guides/personal-tokens/)，并将其配置为环境变量 `AZION_TOKEN`。更多相关信息可以在 [文档](https://www.azion.com/en/documentation/) 中找到。

本指南还将使用 [OpenAI 嵌入](../../../docs/integrations/text_embedding/openai)，你需要安装 `@langchain/openai` 集成包。如果你愿意，也可以使用 [其他支持的嵌入模型](../../../docs/integrations/text_embedding)。

```mdx-code-block
import IntegrationInstallTooltip from "@mdx_components/integration_install_tooltip.mdx";
import Npm2Yarn from "@theme/Npm2Yarn";

<IntegrationInstallTooltip></IntegrationInstallTooltip>

<Npm2Yarn>
  azion @langchain/openai @langchain/community
</Npm2Yarn>
```

### 凭证

完成安装后，设置 `AZION_TOKEN` 环境变量：

```typescript
process.env.AZION_TOKEN = "your-api-key";
```

如果本指南中使用了 OpenAI 嵌入，还需要设置你的 OpenAI 密钥：

```typescript
process.env.OPENAI_API_KEY = "YOUR_API_KEY";
```

如果你想获得模型调用的自动追踪，还可以取消以下 [LangSmith](https://docs.smith.langchain.com/) API 密钥的注释：

```typescript
// process.env.LANGCHAIN_TRACING_V2="true"
// process.env.LANGCHAIN_API_KEY="your-api-key"
```

## 实例化

```typescript
import { AzionVectorStore } from "@langchain/community/vectorstores/azion_edgesql";
import { OpenAIEmbeddings } from "@langchain/openai";

const embeddings = new OpenAIEmbeddings({
  model: "text-embedding-3-small",
});

// 如果数据库和表已经创建，可以使用构造函数实例化
const vectorStore = new AzionVectorStore(embeddings, {
  dbName: "langchain",
  tableName: "documents",
});

// 如果尚未创建数据库和表，可以使用 setupDatabase 方法创建
// await vectorStore.setupDatabase({ columns:["topic","language"], mode: "hybrid" })

// 或者使用静态方法实例化（如果数据库和表尚未创建）
// const vectorStore = await AzionVectorStore.initialize(embeddingModel, { dbName: "langchain", tableName: "documents" }, { columns:[], mode: "hybrid" })
```

## 管理向量存储

### 向向量存储中添加条目

```typescript
import type { Document } from "@langchain/core/documents";

const document1: Document = {
  pageContent: "细胞的动力工厂是线粒体",
  metadata: { language: "zh", topic: "生物学" },
};

const document2: Document = {
  pageContent: "建筑是由砖块建成的",
  metadata: { language: "zh", topic: "历史" },
};

const document3: Document = {
  pageContent: "线粒体由脂质构成",
  metadata: { language: "zh", topic: "生物学" },
};

const document4: Document = {
  pageContent: "2024 年奥运会将在巴黎举行",
  metadata: { language: "zh", topic: "历史" },
};

const documents = [document1, document2, document3, document4];

await vectorStore.addDocuments(documents);
```

```text
插入数据块
插入第 0 个数据块
数据块插入完成！
```

### 从向量存储中删除条目

```typescript
await vectorStore.delete(["4"]);
```

```text
从 documents 中删除了 1 个项目
```

## 查询向量存储

一旦你的向量存储创建完成并添加了相关文档，你很可能会在运行你的链或代理时查询它。

### 直接查询

进行简单的相似性搜索可以如下进行：

```typescript
const filter = [{ operator: "=", column: "language", value: "en" }];

const hybridSearchResults = await vectorStore.azionHybridSearch("biology", {
  kfts: 2,
  kvector: 1,
  filter: [{ operator: "=", column: "language", value: "en" }],
});

console.log("混合搜索结果");
for (const doc of hybridSearchResults) {
  console.log(`${JSON.stringify(doc)}`);
}
```

```text
混合搜索结果
[{"pageContent":"The Australian dingo is a unique species that plays a key role in the ecosystem","metadata":{"searchtype":"fulltextsearch"},"id":"6"},-0.25748711028997995]
[{"pageContent":"The powerhouse of the cell is the mitochondria","metadata":{"searchtype":"fulltextsearch"},"id":"16"},-0.31697985337654005]
[{"pageContent":"Australia s indigenous people have inhabited the continent for over 65,000 years","metadata":{"searchtype":"similarity"},"id":"3"},0.14822345972061157]
```

```typescript
const similaritySearchResults = await vectorStore.azionSimilaritySearch(
  "australia",
  { kvector: 3, filter: [{ operator: "=", column: "topic", value: "history" }] }
);

console.log("相似性搜索结果");
for (const doc of similaritySearchResults) {
  console.log(`${JSON.stringify(doc)}`);
}
```

```text
相似性搜索结果
[{"pageContent":"Australia s indigenous people have inhabited the continent for over 65,000 years","metadata":{"searchtype":"similarity"},"id":"3"},0.4486490488052368]
```

### 通过转换为检索器进行查询

你还可以将向量存储转换为 [检索器](../../../docs/concepts/#retrievers)，以便在链中更方便地使用。

```typescript
const retriever = vectorStore.asRetriever({
  // 可选过滤器
  filter: filter,
  k: 2,
});
await retriever.invoke("biology");
```

```text
[
  Document {
    pageContent: 'Australia s indigenous people have inhabited the continent for over 65,000 years',
    metadata: { searchtype: 'similarity' },
    id: '3'
  },
  Document {
    pageContent: 'Mitochondria are made out of lipids',
    metadata: { searchtype: 'similarity' },
    id: '18'
  }
]
```

### 用于检索增强生成的用法

关于如何将此向量存储用于检索增强生成 (RAG) 的指南，请参阅以下部分：

- [教程：使用外部知识](../../../docs/tutorials/#working-with-external-knowledge)
- [如何：使用 RAG 进行问答](../../../docs/how_to/#qa-with-rag)
- [检索概念文档](../../../docs/concepts/retrieval)

## API 参考

有关 `AzionVectorStore` 所有功能和配置的详细文档，请参阅 [API 参考](https://api.js.langchain.com/classes/_langchain_community.vectorstores_azion_edgesql.AzionVectorStore.html)。